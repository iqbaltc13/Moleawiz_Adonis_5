@layout('layouts.appfix')
@section('title')
  <title>Moleawiz|Dashboard | UBold - Responsive Admin Dashboard Template</title>
@endsection

@section('style')
  <link href="{{ BASE_URL() }}/templates/UBold_v5.1.0/Admin/dist/assets/libs/sweetalert2/sweetalert2.min.css"
        rel="stylesheet" type="text/css"/>
  <link
    href="{{ BASE_URL() }}/templates/UBold_v5.1.0/Admin/dist/assets/libs/admin-resources/jquery.vectormap/jquery-jvectormap-1.2.2.css"
    rel="stylesheet" type="text/css"/>
  <link href="{{ BASE_URL() }}/templates/UBold_v5.1.0/Admin/dist/assets/libs/flatpickr/flatpickr.min.css"
        rel="stylesheet" type="text/css"/>
  <link
    href="{{ BASE_URL() }}/templates/UBold_v5.1.0/Admin/dist/assets/libs/bootstrap-datepicker/css/bootstrap-datepicker.min.css"
    rel="stylesheet" type="text/css"/>
  <link
    href="{{ BASE_URL() }}/templates/UBold_v5.1.0/Admin/dist/assets/libs/bootstrap-datepicker/css/bootstrap-datepicker.min.css"
    rel="stylesheet" type="text/css"/>
  <style>
    .bottom-wrapper {
      margin-top: 0.5em;
    }
    .top-wrapper {
      margin-bottom: 0.5em;
    }
    .dataTables_length_custom{
      padding-bottom: 0px!important;
    }
    .dataTables_filter_custom{
      padding-bottom: 0px!important;
    }
    .search-datatable {
        border-radius: 30px!important;
          /* background-image: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgICB4bWxuczpjYz0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjIiAgIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyIgICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiAgIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgICB2ZXJzaW9uPSIxLjEiICAgaWQ9InN2ZzQ0ODUiICAgdmlld0JveD0iMCAwIDIxLjk5OTk5OSAyMS45OTk5OTkiICAgaGVpZ2h0PSIyMiIgICB3aWR0aD0iMjIiPiAgPGRlZnMgICAgIGlkPSJkZWZzNDQ4NyIgLz4gIDxtZXRhZGF0YSAgICAgaWQ9Im1ldGFkYXRhNDQ5MCI+ICAgIDxyZGY6UkRGPiAgICAgIDxjYzpXb3JrICAgICAgICAgcmRmOmFib3V0PSIiPiAgICAgICAgPGRjOmZvcm1hdD5pbWFnZS9zdmcreG1sPC9kYzpmb3JtYXQ+ICAgICAgICA8ZGM6dHlwZSAgICAgICAgICAgcmRmOnJlc291cmNlPSJodHRwOi8vcHVybC5vcmcvZGMvZGNtaXR5cGUvU3RpbGxJbWFnZSIgLz4gICAgICAgIDxkYzp0aXRsZT48L2RjOnRpdGxlPiAgICAgIDwvY2M6V29yaz4gICAgPC9yZGY6UkRGPiAgPC9tZXRhZGF0YT4gIDxnICAgICB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwLC0xMDMwLjM2MjIpIiAgICAgaWQ9ImxheWVyMSI+ICAgIDxnICAgICAgIHN0eWxlPSJvcGFjaXR5OjAuNSIgICAgICAgaWQ9ImcxNyIgICAgICAgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoNjAuNCw4NjYuMjQxMzQpIj4gICAgICA8cGF0aCAgICAgICAgIGlkPSJwYXRoMTkiICAgICAgICAgZD0ibSAtNTAuNSwxNzkuMSBjIC0yLjcsMCAtNC45LC0yLjIgLTQuOSwtNC45IDAsLTIuNyAyLjIsLTQuOSA0LjksLTQuOSAyLjcsMCA0LjksMi4yIDQuOSw0LjkgMCwyLjcgLTIuMiw0LjkgLTQuOSw0LjkgeiBtIDAsLTguOCBjIC0yLjIsMCAtMy45LDEuNyAtMy45LDMuOSAwLDIuMiAxLjcsMy45IDMuOSwzLjkgMi4yLDAgMy45LC0xLjcgMy45LC0zLjkgMCwtMi4yIC0xLjcsLTMuOSAtMy45LC0zLjkgeiIgICAgICAgICBjbGFzcz0ic3Q0IiAvPiAgICAgIDxyZWN0ICAgICAgICAgaWQ9InJlY3QyMSIgICAgICAgICBoZWlnaHQ9IjUiICAgICAgICAgd2lkdGg9IjAuODk5OTk5OTgiICAgICAgICAgY2xhc3M9InN0NCIgICAgICAgICB0cmFuc2Zvcm09Im1hdHJpeCgwLjY5NjQsLTAuNzE3NiwwLjcxNzYsMC42OTY0LC0xNDIuMzkzOCwyMS41MDE1KSIgICAgICAgICB5PSIxNzYuNjAwMDEiICAgICAgICAgeD0iLTQ2LjIwMDAwMSIgLz4gICAgPC9nPiAgPC9nPjwvc3ZnPg==);
          background-repeat: no-repeat;
          background-color: #fff;
          background-position: 0px 3px !important; */

    }

    .tr-odd{
      border-color: transparent!important;
      background-color: #F7F9FC!important;
    }
    .tr-even{
      border-color: transparent!important;
      background-color: #FFFFFF!important;
    }
    .pd-top-pagination{
      padding-top: 16px!important;;
    }
    .add-button{
      background-color: #FFFFFF!important;
      border-color: #6D757D!important;
    }
    .add-button:hover {
      border-color: #DF2333!important;
      background-color: #DF2333!important;
      color: white!important;
    }
    .page-item.active .page-link {
        /* z-index: 3; */
        position: relative;
        display: block;
        color: #fff;
        background-color: #DF2333;
        border-color: #DF2333;
    }
    /* .card-drop:hover{
      color: #DF2333!important;
    } */
  </style>

@endsection
@section('navbar')
  @include('layouts.navbar.navbar_custom')
@endsection

@section('left_sidebar')
  @include('layouts.sidebar.sidebar_left_base')
@endsection
@section('content')
  <div class="content-page">
    <div class="content">
      @loggedIn
      <input type="hidden" value="{{authUser.firstname +' '+ authUser.lastname}}" id="auth_name">
      @else
        <script>
          window.location.replace("{{route('login')}}");
        </script>
        @endloggedIn

        <!-- Start Content-->
        <div class="container-fluid">

          <!-- start page title -->
          <div class="row">
            <div class="col-12">
              <div class="page-title-box">
                <div class="page-title-right">
                  <ol class="breadcrumb m-0">
                    <li class="breadcrumb-item  breadcrumb-link"><a class="breadcrumb-link text-hover-color-scheme"  href="{{route('dashboard')}}">DASHBOARD</a></li>
                    <li class="breadcrumb-item  breadcrumb-link active">Active Learners</li>
                  </ol>
                </div>
                <div class="row">
                  <div class="col-lg-2">
                    <a href="{{route('dashboard')}}" ><h4 class="page-title back-button  text-hover-color-scheme"><i class="mdi mdi-arrow-left"></i> Back</h4> </a>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- end page title -->


          <!-- end row -->

          <div class="row">
            <div class="col-lg-12">
            </div>
            <div class="col-lg-12">
              <div class="card">
                <div class="card-body">
                  <div class="dropdown float-end">
                    <a href="#" class="dropdown-toggle arrow-none card-drop" data-bs-toggle="dropdown"
                       aria-expanded="false">
                      <i class="mdi mdi-dots-vertical"></i>
                    </a>

                  </div>

                  <h4 class="header-title mb-0">Active Learners</h4>
                  <h5 class="header-title mb-0" id="direcorate-name"></h5>
                  <div class="row" style="padding-top:20px;">
                    <div class="col-lg-6">
                      <div>
                        <label for="directorateid" class="form-label">Directorate
                        </label>
                        <select name="directorateid" class="form-select form-select-custom" style="color:#333333;" id="directorateid" required>
                          <option value="0">- select -</option>
                          @each(item in masterDirectorate)
                          <option value="{{item.data}}">{{item.data}}</option>
                          @endeach
                        </select>


                      </div>
                      <div style="padding-top:10px;">
                        <label for="subdirectorateid" class="form-label">Division
                        </label>
                        <select name="subdirectorateid" class="form-select form-select-custom" style="color:#333333;" id="subdirectorateid" required>
                          <option value="0">- select -</option>
                          @each(itemDivision in masterDivision)
                          <option value="{{itemDivision.subdirectorate}}">{{itemDivision.subdirectorate}}</option>
                          @endeach
                        </select>


                      </div>

                    </div>
                    <div class="col-lg-6">
                      <div>
                        <label class="form-label" style="padding-left:400px">Date Range</label>
                        <div class="input-group input-group-merge">
                          <div class="input-group-text">
                            <i class="fas fa-calendar-alt"></i>

                          </div>
                          <input type="text" id="range-dateenrol" class="form-control" style="color:#333333;">
                        </div>
                      </div>
                      <div style="padding-top:30px;">
                        <label for="sortBy" class="form-label" style="padding-left:440px;">Order
                        </label>
                        <select name="sortBy" class="form-select form-select-custom" style="color:#333333;" id="sortBy" required>
                          <option value="activeUser">Active</option>
                          <option value="inactiveUser">Inactive</option>
                          <option value="0"> - All -</option>
                        </select>


                      </div>

                    </div>
                    <div class="btn-toolbar" style="padding-bottom:8px">
                      <div class="btn-group dropdown-btn-group pull-left" style="padding-bottom:20px;">

                      </div>
                      <div class="btn-group dropdown-btn-group pull-right" style="padding-bottom:20px;">


                      </div>
                    </div>
                    <div class="col-sm-12">
                      <table id="datatable" class="table w-100 nowrap" role="grid" aria-describedby="datatable-buttons_info" style="width: 924px;">
                        <thead style="color: white;  background: #DF2333;">
                          <tr>
                              <th valign="middle" >Name</th>
                              <th valign="middle" >Email Address</th>
                              <th valign="middle" >City/Town</th>
                              <th valign="middle" >Country</th>
                              <th valign="middle" >Last Access</th>
                              <th valign="middle" ></th>
                          </tr>
                          </thead>


                          <tbody>
                              @each(result in results)

                              <tr>
                              <td valign="middle">
                                  <script>
                                  i++;
                                  document.write(i)
                                  </script>
                              </td>
                              <td valign="middle" style="max-width: 70px;
                                      text-overflow: ellipsis;
                                      white-space: nowrap;
                                      overflow: hidden;">{{ result.nip}}</td>
                              <td valign="middle" style="max-width: 70px;
                                      text-overflow: ellipsis;
                                      white-space: nowrap;
                                      overflow: hidden;">{{ result.fullname}}</td>
                              <td valign="middle">{{ result.directorate }}</td>
                              <td valign="middle">{{ result.subdirectorate}}</td>

                              <td valign="middle">
                                  {{result.access_date2}}

                              </td>

                              </tr>

                              @endeach
                          </tbody>
                          </table>
                      </div>
                  </div>


                </div>
              </div> <!-- end card -->
            </div> <!-- end col-->


          </div>


          <!-- end row -->


        </div> <!-- content -->

        <!-- Footer Start -->
        @include('layouts.footer')
        <!-- end Footer -->
        @include('layouts.modal_and_alert')

    </div>
    @endsection
    @section('right_sidebar')
      @include('layouts.sidebar.sidebar_right_base')
    @endsection
    @section('script')
      <script src="{{ BASE_URL() }}/templates/UBold_v5.1.0/Admin/dist/assets/libs/apexcharts/apexcharts.min.js"></script>
      -->
      <!-- Dashboar 1 init js-->
      <script src="https://apexcharts.com/samples/assets/irregular-data-series.js"></script>
      <script src="https://apexcharts.com/samples/assets/ohlc.js"></script>
      <script
        src="{{ BASE_URL() }}/templates/UBold_v5.1.0/Admin/dist/assets/libs/sweetalert2/sweetalert2.all.min.js"></script>
      <script
        src="{{ BASE_URL() }}/templates/UBold_v5.1.0/Admin/dist/assets/libs/jquery-sparkline/jquery.sparkline.min.js"></script>
      <script
        src="{{ BASE_URL() }}/templates/UBold_v5.1.0/Admin/dist/assets/libs/admin-resources/jquery.vectormap/jquery-jvectormap-1.2.2.min.js"></script>
      <script
        src="{{ BASE_URL() }}/templates/UBold_v5.1.0/Admin/dist/assets/libs/admin-resources/jquery.vectormap/maps/jquery-jvectormap-world-mill-en.js"></script>
      <script src="{{ BASE_URL() }}/templates/UBold_v5.1.0/Admin/dist/assets/libs/flatpickr/flatpickr.min.js"></script>
      <script
        src="{{ BASE_URL() }}/templates/UBold_v5.1.0/Admin/dist/assets/libs/datatables.net/js/jquery.dataTables.min.js"></script>
      <script
        src="{{ BASE_URL() }}/templates/UBold_v5.1.0/Admin/dist/assets/libs/datatables.net-bs4/js/dataTables.bootstrap4.min.js"></script>
      <script
        src="{{ BASE_URL() }}/templates/UBold_v5.1.0/Admin/dist/assets/libs/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
      <script
        src="{{ BASE_URL() }}/templates/UBold_v5.1.0/Admin/dist/assets/libs/datatables.net-keytable/js/dataTables.keyTable.min.js"></script>
      <script
        src="{{ BASE_URL() }}/templates/UBold_v5.1.0/Admin/dist/assets/libs/datatables.net-select/js/dataTables.select.min.js"></script>
      <script src="{{ BASE_URL() }}/templates/UBold_v5.1.0/Admin/dist/assets/libs/pdfmake/build/pdfmake.min.js"></script>
      <script src="{{ BASE_URL() }}/templates/UBold_v5.1.0/Admin/dist/assets/libs/pdfmake/build/vfs_fonts.js"></script>


      <script>
        $(document).ready(function () {
          $(".mlw-li").hide()
          $(".mlw-li-dashboard").show()
          let curRangeDateStart = "{{startdate}}";
          let curRangeDateEnd = "{{enddate}}";

          let sortBy = "{{sortBy}}";


          let directorateid = "{{directorateid}}";

          let subdirectorateid = "{{subdirectorateid}}";


          // $('#direcorate-name').html(directorateid);
          // $('#subdirecorate-name').html(subdirectorateid);
          $('#sortBy').val(sortBy).change();
          $('#sortBy').selectize();
          $(document).delegate("#sortBy", "change", function () {
            sortBy = $('select[name=sortBy] option').filter(':selected').val()
            window.location.href = "{{route('dashboard.user.index-active-learners')}}" + "?startdate=" + curRangeDateStart + "&" + "enddate=" + curRangeDateEnd + "&" + "sortBy=" + sortBy + "&directorateid=" + directorateid + "&subdirectorateid=" + subdirectorateid;
          });

          $('#directorateid').val(directorateid).change();
          $('#directorateid').selectize();
          $(document).delegate("#directorateid", "change", function () {
            directorateid = $('select[name=directorateid] option').filter(':selected').val()
            $('#direcorate-name').html(directorateid);
            window.location.href = "{{route('dashboard.user.index-active-learners')}}" + "?startdate=" + curRangeDateStart + "&" + "enddate=" + curRangeDateEnd + "&" + "sortBy=" + sortBy + "&directorateid=" + directorateid + "&subdirectorateid=" + subdirectorateid;
          });

          $('#subdirectorateid').val(subdirectorateid).change();
          $('#subdirectorateid').selectize();
          $(document).delegate("#subdirectorateid", "change", function () {
            subdirectorateid = $('select[name=subdirectorateid] option').filter(':selected').val()
            $('#subdirecorate-name').html(subdirectorateid);
            window.location.href = "{{route('dashboard.user.index-active-learners')}}" + "?startdate=" + curRangeDateStart + "&" + "enddate=" + curRangeDateEnd + "&" + "sortBy=" + sortBy + "&directorateid=" + directorateid + "&subdirectorateid=" + subdirectorateid;
          });


          $('#range-dateenrol').val(function () {
            return curRangeDateStart.replace("-", "/") + " to " + curRangeDateEnd.replace("-", "/");
          });
          $('#range-dateenrol').flatpickr({
            mode: "range",
            dateFormat: "Y/m/d",
            conjunction: " - ",
            onChange: function (selectedDates, dateStr, instance) {
              //console.log(selectedDates,dateStr);
            },
            onClose: function (selectedDates, dateStr, instance) {


              let arrDate = dateStr.split(" to ");

              curRangeDateStart = arrDate[0].split("/").join("-");
              curRangeDateEnd = arrDate[1].split("/").join("-");
              console.log(curRangeDateStart, curRangeDateEnd);
              directorateid = $('select[name=directorateid] option').filter(':selected').val()
              subdirectorateid = $('select[name=subdirectorateid] option').filter(':selected').val()
              sortBy = $('select[name=sortBy] option').filter(':selected').val()
              window.location.href = "{{route('dashboard.user.index-active-learners')}}" + "?startdate=" + curRangeDateStart + "&" + "enddate=" + curRangeDateEnd + "&" + "sortBy=" + sortBy + "&directorateid=" + directorateid + "&subdirectorateid=" + subdirectorateid;


            }
          });



          @if(flashMessage('error'))
          let urllogout = "{{ route('logout')}}"
          Swal.fire({
            icon: 'error',
            title: 'Access Denied!',
            text: "{{flashMessage('error')}}",
            confirmButtonText: 'Yes, I will logout'
          }).then((result) => {
            if (result.isConfirmed) {
              window.location.href = urllogout;
            }
          })
          @endif

          $("#datatable").DataTable({
            columnDefs: [
              //{ "orderable": false, "targets": 0 },
              { "type": "num", "width" : "18px", "targets" : 0},


            ],

            language: {
            search : ' ', /*Empty to remove the label*/

            info: "Showing _START_ to _END_ of _TOTAL_ learners",
            infoEmpty : "Showing 0 to 0 of 0 learners",
            infoFiltered : "(filtered from _MAX_ total learners)"
          },
          order: [

          ],
          aLengthMenu : [[25, 50, 75, -1], [25, 50, 75, "All"]],
          iDisplayLength: 25,

            scrollX: !0,
            //dom: 'Bfrltip',

            // buttons: [
            //   {
            //     extend: 'copy',
            //     exportOptions: {
            //       columns: [0, 1, 2, 3, 4, 5]
            //     }
            //   },
            //   {
            //     extend: 'csv',
            //     exportOptions: {
            //       columns: [0, 1, 2, 3, 4, 5]
            //     }
            //   },
            //   {
            //     extend: 'pdf',
            //     exportOptions: {
            //       columns: [0, 1, 2, 3, 4, 5]
            //     }
            //   },
            //   {
            //     extend: 'print',
            //     exportOptions: {
            //       columns: [0, 1, 2, 3, 4, 5]
            //     }
            //   },

            // ],
            pagingType:
              "full_numbers",
            drawCallback: function () {
              $("thead").css("background",dataThemes.color_scheme);
              $(".dataTables_paginate > .pagination").addClass("pagination-default")
              $(".dataTables_info").addClass("pd-top-pagination")
              $(".dataTables_paginate").addClass("pd-top-pagination")
              $(".odd").addClass("tr-odd")
              $(".even").addClass("tr-even")
              $('input[type="search"]').addClass("search-datatable")
              $('input[type="search"]').attr("placeholder", "    Search here");
              $('.dataTables_length').addClass('dataTables_length_custom');
              $('.dataTables_filter').addClass('dataTables_filter_custom');
              $(".page-item.active .page-link").css("background-color",dataThemes.color_scheme);
              $(".page-item.active .page-link").css("border-color",dataThemes.color_scheme);
            }
          }),
          $(".dataTables_length select").addClass("form-select form-select-sm"),
          $(".dataTables_length select").removeClass("custom-select custom-select-sm"),
          $(".dataTables_length label").addClass("form-label")
          $(".dataTables_filter label").addClass("form-label")


          //
        })
      </script>

@endsection
