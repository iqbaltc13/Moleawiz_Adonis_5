@layout('layouts.appfix')
@section('title')
  <title>Moleawiz|Dashboard|Completions| Favourite Content Library</title>
@endsection
@section('style')
  <!-- third party css -->
  <link href="{{ BASE_URL() }}/templates/UBold_v5.1.0/Admin/dist/assets/libs/sweetalert2/sweetalert2.min.css"
        rel="stylesheet" type="text/css"/>
  <link
        href="{{ BASE_URL() }}/templates/UBold_v5.1.0/Admin/dist/assets/libs/admin-resources/jquery.vectormap/jquery-jvectormap-1.2.2.css"
        rel="stylesheet" type="text/css"/>
  <link
    href="{{ BASE_URL() }}/templates/UBold_v5.1.0/Admin/dist/assets/libs/datatables.net-bs4/css/dataTables.bootstrap4.min.css"
    rel="stylesheet" type="text/css"/>
  <link
    href="{{ BASE_URL() }}/templates/UBold_v5.1.0/Admin/dist/assets/libs/datatables.net-responsive-bs4/css/responsive.bootstrap4.min.css"
    rel="stylesheet" type="text/css"/>
  <link
    href="{{ BASE_URL() }}/templates/UBold_v5.1.0/Admin/dist/assets/libs/datatables.net-buttons-bs4/css/buttons.bootstrap4.min.css"
    rel="stylesheet" type="text/css"/>
  <link
    href="{{ BASE_URL() }}/templates/UBold_v5.1.0/Admin/dist/assets/libs/datatables.net-select-bs4/css/select.bootstrap4.min.css"
    rel="stylesheet" type="text/css"/>
  <link href="{{ BASE_URL() }}/templates/UBold_v5.1.0/Admin/dist/assets/libs/selectize/css/selectize.bootstrap4.css" rel="stylesheet" type="text/css"/>
  <!-- third party css end -->
  <style>
    .bottom-wrapper {
      margin-top: 0.5em;
    }
    .top-wrapper {
      margin-bottom: 0.5em;
    }
    .dataTables_length_custom{
      padding-bottom: 0px!important;
    }
    .dataTables_filter_custom{
      padding-bottom: 0px!important;
    }
    .search-datatable {
        border-radius: 30px!important;
          /* background-image: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgICB4bWxuczpjYz0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjIiAgIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyIgICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiAgIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgICB2ZXJzaW9uPSIxLjEiICAgaWQ9InN2ZzQ0ODUiICAgdmlld0JveD0iMCAwIDIxLjk5OTk5OSAyMS45OTk5OTkiICAgaGVpZ2h0PSIyMiIgICB3aWR0aD0iMjIiPiAgPGRlZnMgICAgIGlkPSJkZWZzNDQ4NyIgLz4gIDxtZXRhZGF0YSAgICAgaWQ9Im1ldGFkYXRhNDQ5MCI+ICAgIDxyZGY6UkRGPiAgICAgIDxjYzpXb3JrICAgICAgICAgcmRmOmFib3V0PSIiPiAgICAgICAgPGRjOmZvcm1hdD5pbWFnZS9zdmcreG1sPC9kYzpmb3JtYXQ+ICAgICAgICA8ZGM6dHlwZSAgICAgICAgICAgcmRmOnJlc291cmNlPSJodHRwOi8vcHVybC5vcmcvZGMvZGNtaXR5cGUvU3RpbGxJbWFnZSIgLz4gICAgICAgIDxkYzp0aXRsZT48L2RjOnRpdGxlPiAgICAgIDwvY2M6V29yaz4gICAgPC9yZGY6UkRGPiAgPC9tZXRhZGF0YT4gIDxnICAgICB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwLC0xMDMwLjM2MjIpIiAgICAgaWQ9ImxheWVyMSI+ICAgIDxnICAgICAgIHN0eWxlPSJvcGFjaXR5OjAuNSIgICAgICAgaWQ9ImcxNyIgICAgICAgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoNjAuNCw4NjYuMjQxMzQpIj4gICAgICA8cGF0aCAgICAgICAgIGlkPSJwYXRoMTkiICAgICAgICAgZD0ibSAtNTAuNSwxNzkuMSBjIC0yLjcsMCAtNC45LC0yLjIgLTQuOSwtNC45IDAsLTIuNyAyLjIsLTQuOSA0LjksLTQuOSAyLjcsMCA0LjksMi4yIDQuOSw0LjkgMCwyLjcgLTIuMiw0LjkgLTQuOSw0LjkgeiBtIDAsLTguOCBjIC0yLjIsMCAtMy45LDEuNyAtMy45LDMuOSAwLDIuMiAxLjcsMy45IDMuOSwzLjkgMi4yLDAgMy45LC0xLjcgMy45LC0zLjkgMCwtMi4yIC0xLjcsLTMuOSAtMy45LC0zLjkgeiIgICAgICAgICBjbGFzcz0ic3Q0IiAvPiAgICAgIDxyZWN0ICAgICAgICAgaWQ9InJlY3QyMSIgICAgICAgICBoZWlnaHQ9IjUiICAgICAgICAgd2lkdGg9IjAuODk5OTk5OTgiICAgICAgICAgY2xhc3M9InN0NCIgICAgICAgICB0cmFuc2Zvcm09Im1hdHJpeCgwLjY5NjQsLTAuNzE3NiwwLjcxNzYsMC42OTY0LC0xNDIuMzkzOCwyMS41MDE1KSIgICAgICAgICB5PSIxNzYuNjAwMDEiICAgICAgICAgeD0iLTQ2LjIwMDAwMSIgLz4gICAgPC9nPiAgPC9nPjwvc3ZnPg==);
          background-repeat: no-repeat;
          background-color: #fff;
          background-position: 0px 3px !important; */

    }

    .tr-odd{
      border-color: transparent!important;
      background-color: #F7F9FC!important;
    }
    .tr-even{
      border-color: transparent!important;
      background-color: #FFFFFF!important;
    }
    .pd-top-pagination{
      padding-top: 16px!important;;
    }
    .add-button{
      background-color: #FFFFFF!important;
      border-color: #6D757D!important;
    }
    .add-button:hover {
      border-color: #DF2333!important;
      background-color: #DF2333!important;
      color: white!important;
    }
    .page-item.active .page-link {
        /* z-index: 3; */
        position: relative;
        display: block;
        color: #fff;
        background-color: #DF2333;
        border-color: #DF2333;
    }
    /* .card-drop:hover{
      color: #DF2333!important;
    } */
  </style>
@endsection
@section('navbar')
  @include('layouts.navbar.navbar_custom')
@endsection

@section('left_sidebar')
  @include('layouts.sidebar.sidebar_left_base')
@endsection
@section('content')
  <div class="content-page">
    <div class="content">
      @loggedIn
      <input type="hidden" value="{{authUser.firstname +' '+ authUser.lastname}}" id="auth_name">
      @else
        <script>
          window.location.replace("{{route('login')}}");
        </script>
        @endloggedIn

        <!-- Start Content-->
        <div class="container-fluid">

          <!-- start page title -->
          <div class="row">
            <div class="col-12">
              <div class="page-title-box">
                <div class="page-title-right">
                  <ol class="breadcrumb m-0">
                    <li class="breadcrumb-item  breadcrumb-link"><a class="breadcrumb-link text-hover-color-scheme"  href="{{route('dashboard')}}">DASHBOARD</a></li>
                    <li class="breadcrumb-item  breadcrumb-link active">Favourite Content Library</li>
                  </ol>
                </div>
                <div class="row">
                  <div class="col-lg-2">
                    <a href="{{route('dashboard')}}" ><h4 class="page-title back-button  text-hover-color-scheme"><i class="mdi mdi-arrow-left"></i> Back</h4> </a>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-12">
                <div class="card">

                    <div class="card-body">

                      <h4 class="page-title">Favourite Content Library  <i
                        class="mdi mdi-information mdi-18px" title="Put cursor at bar chart to view number" tabindex="0"
                        data-plugin="tippy" data-tippy-theme="translucent"></i></h4>

                        <div  class="responsive-table-plugin dataTables_wrapper dt-bootstrap4 no-footer">

                            <div class="row">

                                <div class="col align-self-start">

                                </div>

                                <div class="col align-self-end">

                                </div>

                            </div>
                            <div class="row">
                              <div class="col-lg-6">

                                <div class="row mb-3">
                                    <label for="directorateid" class="col-5 col-xl-2 form-label">Directorate</label>
                                    <div class="col-8 col-xl-8">
                                        <select name="directorateid" class="form-select form-select-custom" style="color:#333333;" id="directorateid" required>
                                            <option value="0">Select Directorate</option>
                                            @each(item in masterDirectorate)
                                            <option value="{{item.data}}">{{item.data}}</option>
                                            @endeach
                                          </select>

                                    </div>
                                  </div>


                                <div class="row mb-3">
                                    <label for="directorateid" class="col-5 col-xl-2 form-label">Order</label>
                                    <div class="col-8 col-xl-8">
                                        <select name="orderby" class="form-select form-select-custom" style="color:#333333;" id="orderby" required>
                                            <option value="DESC">Descending</option>
                                            <option value="ASC">Ascending</option>

                                          </select>
                                    </div>
                                  </div>


                              </div>
                              <div class="col-lg-6">

                                <div class="row mb-3">
                                  <label for="range-dateenrol" class="col-5 col-xl-2 form-label">
                                    Date Range
                                  </label>
                                  <div class="col-8 col-xl-8">
                                    <div class="input-group input-group-merge">
                                      <div class="input-group-text">
                                        <i class="fas fa-calendar-alt"></i>

                                      </div>
                                      <input type="text" id="range-dateenrol" name="range-dateenrol" class="form-control" style="color:#333333;">
                                    </div>
                                  </div>
                                </div>





                              </div>

                              <div class="btn-toolbar" style="padding-bottom:8px">
                                <div class="btn-group dropdown-btn-group pull-left" style="padding-bottom:20px;">

                                </div>
                                <div class="btn-group dropdown-btn-group pull-right" style="padding-bottom:20px;">


                                </div>
                              </div>
                              <div class="col-sm-12">
                                 <div class="widget-chart text-center" dir="ltr">

                                    <div id="cardCollpase8" class="collapse pt-3 show" dir="ltr">
                                        <div id="completions-by-content-library" class="apex-charts"
                                             style="padding-bottom: 20px;"></div>
                                      </div>


                                </div>
                      </div>
                    </div>

                  </div>

                </div> <!-- end card body-->
              </div> <!-- end card -->
            </div><!-- end col-->
          </div>
          <!-- end row-->

        </div> <!-- container -->

    </div> <!-- content -->

    <!-- Footer Start -->
  @include('layouts.footer')
  <!-- end Footer -->
  @include('layouts.modal_and_alert')
  </div>
@endsection
@section('right_sidebar')
  @include('layouts.sidebar.sidebar_right_base')
@endsection
@section('script')
  <!-- third party js -->
  <script
    src="{{ BASE_URL() }}/templates/UBold_v5.1.0/Admin/dist/assets/libs/datatables.net/js/jquery.dataTables.min.js"></script>
  <script
    src="{{ BASE_URL() }}/templates/UBold_v5.1.0/Admin/dist/assets/libs/datatables.net-bs4/js/dataTables.bootstrap4.min.js"></script>
  <script
    src="{{ BASE_URL() }}/templates/UBold_v5.1.0/Admin/dist/assets/libs/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
  <script
    src="{{ BASE_URL() }}/templates/UBold_v5.1.0/Admin/dist/assets/libs/datatables.net-responsive-bs4/js/responsive.bootstrap4.min.js"></script>
  <script
    src="{{ BASE_URL() }}/templates/UBold_v5.1.0/Admin/dist/assets/libs/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
  <script
    src="{{ BASE_URL() }}/templates/UBold_v5.1.0/Admin/dist/assets/libs/datatables.net-buttons-bs4/js/buttons.bootstrap4.min.js"></script>
  <script
    src="{{ BASE_URL() }}/templates/UBold_v5.1.0/Admin/dist/assets/libs/datatables.net-buttons/js/buttons.html5.min.js"></script>
  <script
    src="{{ BASE_URL() }}/templates/UBold_v5.1.0/Admin/dist/assets/libs/datatables.net-buttons/js/buttons.flash.min.js"></script>
  <script
    src="{{ BASE_URL() }}/templates/UBold_v5.1.0/Admin/dist/assets/libs/datatables.net-buttons/js/buttons.print.min.js"></script>
  <script
    src="{{ BASE_URL() }}/templates/UBold_v5.1.0/Admin/dist/assets/libs/datatables.net-keytable/js/dataTables.keyTable.min.js"></script>
  <script
    src="{{ BASE_URL() }}/templates/UBold_v5.1.0/Admin/dist/assets/libs/datatables.net-select/js/dataTables.select.min.js"></script>
  <script src="{{ BASE_URL() }}/templates/UBold_v5.1.0/Admin/dist/assets/libs/pdfmake/build/pdfmake.min.js"></script>
  <script src="{{ BASE_URL() }}/templates/UBold_v5.1.0/Admin/dist/assets/libs/pdfmake/build/vfs_fonts.js"></script>
  <!-- Sweet Alerts js -->
  <script src="{{ BASE_URL() }}/templates/UBold_v5.1.0/Admin/dist/assets/libs/sweetalert2/sweetalert2.all.min.js"></script>
    <script
    src="{{ BASE_URL() }}/templates/UBold_v5.1.0/Admin/dist/assets/libs/selectize/js/standalone/selectize.min.js"></script>
  <script src="{{ BASE_URL() }}/templates/UBold_v5.1.0/Admin/dist/assets/libs/apexcharts/apexcharts.min.js"></script>
  <!-- Dashboar 1 init js-->
  <script src="https://apexcharts.com/samples/assets/irregular-data-series.js"></script>
  <script src="https://apexcharts.com/samples/assets/ohlc.js"></script>
  <script
    src="{{ BASE_URL() }}/templates/UBold_v5.1.0/Admin/dist/assets/libs/jquery-sparkline/jquery.sparkline.min.js"></script>
  <script
    src="{{ BASE_URL() }}/templates/UBold_v5.1.0/Admin/dist/assets/libs/admin-resources/jquery.vectormap/jquery-jvectormap-1.2.2.min.js"></script>
  <script
    src="{{ BASE_URL() }}/templates/UBold_v5.1.0/Admin/dist/assets/libs/admin-resources/jquery.vectormap/maps/jquery-jvectormap-world-mill-en.js"></script>
  <script src="{{ BASE_URL() }}/templates/UBold_v5.1.0/Admin/dist/assets/libs/flatpickr/flatpickr.min.js"></script>

  <script>
    let curRangeDateStart = "{{startdate}}";
    let curRangeDateEnd = "{{enddate}}";
    let orderby = "{{orderby}}";
    let directorateid = "{{directorateid}}";
    let urlGetCompletionbyLearningProgramTop = "{{route('dashboard.completion.get-completion-by-content-library')}}" + "?startdate=" + curRangeDateStart + "&" + "enddate=" + curRangeDateEnd + "&" + "orderby=" + orderby + "&directorateid=" + directorateid;

    $(document).ready(function () {
    $(".mlw-li").hide()
    $(".mlw-li-dashboard").show()


    $('#direcorate-name').html(directorateid);

    $('#orderby').val(orderby).change();

    $(document).delegate("#orderby", "change", function () {
      orderby = $('select[name=orderby] option').filter(':selected').val()
      window.location.href = "{{route('dashboard.completion.index-by-content-library')}}" + "?startdate=" + curRangeDateStart + "&" + "enddate=" + curRangeDateEnd + "&" + "orderby=" + orderby + "&directorateid=" + directorateid;
    });

    $('#directorateid').val(directorateid).change();

    $(document).delegate("#directorateid", "change", function () {
      directorateid = $('select[name=directorateid] option').filter(':selected').val()
      $('#direcorate-name').html(directorateid);
      window.location.href = "{{route('dashboard.completion.index-by-content-library')}}" + "?startdate=" + curRangeDateStart + "&" + "enddate=" + curRangeDateEnd + "&" + "orderby=" + orderby + "&directorateid=" + directorateid;
    });


    $('#range-dateenrol').val(function () {
      return curRangeDateStart.split("-").reverse().join("/") + " to " + curRangeDateEnd.split("-").reverse().join("/");
    });
    $('#range-dateenrol').flatpickr({
      mode: "range",
      dateFormat: "d/m/Y",
      conjunction: " - ",
    onChange: function (selectedDates, dateStr, instance) {
        //console.log(selectedDates,dateStr);
    },
    onClose: function (selectedDates, dateStr, instance) {


        let arrDate = dateStr.split(" to ");
        curRangeDateStart = arrDate[0].split("/").reverse().join("-");
        curRangeDateEnd = arrDate[1].split("/").reverse().join("-");
        console.log(curRangeDateStart, curRangeDateEnd);
        directorateid = $('select[name=directorateid] option').filter(':selected').val()
        orderby = $('select[name=orderby] option').filter(':selected').val()
        window.location.href = "{{route('dashboard.completion.index-by-content-library')}}" + "?startdate=" + curRangeDateStart + "&" + "enddate=" + curRangeDateEnd + "&" + "orderby=" + orderby + "&directorateid=" + directorateid;


    }
    });



    @if(flashMessage('error'))
      let urllogout = "{{ route('logout')}}"
      Swal.fire({
      icon: 'error',
      title: 'Access Denied!',
      text: "{{flashMessage('error')}}",
      confirmButtonText: 'Yes, I will logout'
      }).then((result) => {
      if (result.isConfirmed) {
          window.location.href = urllogout;
      }
      })
    @endif

    fetch(urlGetCompletionbyLearningProgramTop).then(
      res => {
          res.json().then(
          data => {
              //console.log(data);
              var series1 = [];
              var series2 = [];
              var xAxisCategories = [];
              data.forEach((itemData) => {
              if (itemData.total_user_completed == null) {
                  itemData.total_user_completed = 0;
              }
              //   if(itemData.total_incompleted==null){
              //     itemData.total_incompleted = 0;
              //   }
              series1.push(itemData.total_user_completed);
              //series2.push(itemData.total_incompleted);
              xAxisCategories.push(itemData.category);

              });
              console.log(series1, xAxisCategories);
              var colorsCompletionsByContentLibrary = [dataThemes.primary_color,dataThemes.secondary_color];
              var dataColorsCompletionsByContentLibrary = $("#completions-by-content-library").data('colors');
              if (dataColorsCompletionsByContentLibrary) {
              colorsCompletionsByContentLibrary = dataColorsCompletionsByContentLibrary.split(",");
              }


              var chartCompletionsByConrentLibrary = new ApexCharts(
              document.querySelector("#completions-by-content-library"),
              {
                  chart: {
                  height: data.length * 40,
                  type: 'bar',
                  toolbar: {
                      show: false
                  }
                  },
                  plotOptions: {
                  bar: {
                      horizontal: true,
                  }
                  },
                  dataLabels: {
                  enabled: false
                  },
                  series: [{
                  name: 'Complete',
                  data: series1
                  }],
                  colors: colorsCompletionsByContentLibrary,
                  xaxis: {
                  categories: xAxisCategories,
                  },
                  states: {
                  hover: {
                      filter: 'none'
                  }
                  },
                  grid: {
                    borderColor: '#f1f3fa',
                    padding: {
                        top: 0,
                        right: 0,
                        bottom: 5,
                        left: 0
                    },
                  }
              }
              ).render()
          }
          )
      }
      )


    //
})
 </script>

  <!-- third party js ends -->
@endsection
